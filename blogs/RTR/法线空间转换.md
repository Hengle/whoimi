# 法线空间变换推导

问题：法线在遇到非统一的缩放时会出现问题。

解决方案：使用变化矩阵的逆转矩阵进行变换。

推导：	$$ M ​$$ 为变换矩阵。$$ t ​$$ 切线。$$ n ​$$ 为法线。$$ p ​$$ 为模型坐标。

​	         正常的模型变换为：  $$ p' = M * p ​$$

​		 这个变换对切线也适用：$$ t' = M * t ​$$

​		 而法线不行$$ n'  \neq  M * n $$。对于法线我们通过 $$ dot(n, t) =  n^{T}  * t =  0 $$  这个条件来推到用于法线变换的矩阵$$ S $$。

​		*注：上面没有用$$ dot ​$$操作的$$n​$$和$$t​$$ 当做 $$1 * 3​$$的矩阵看待。

​		 $$ 0 = (n')^T * t'  = (Sn)^T * (Mt) = n^T * S^T * M * t = n^T * (S*M)*t$$ 

 		所以$$ I = SM $$ ,所以$$S$$是$$M$$的逆转矩阵.

​		操作 $$n' = (M^T )^{-1}  * n  ​$$  

​                       $$(n')^t = n^T * M^{-1}​$$ 

​                在Unity当中$$mul$$操作结束以后$$ n'  $$ 和 $$(n')^t$$都是$$float3$$ 

​		所以：

```c
n_WorldSpace = mul(n_ObjectSpace, unity_WorldToObejct) ;
```

