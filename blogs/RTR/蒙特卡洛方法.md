# 蒙特卡洛方法

wiki解释:[蒙特卡洛](https://zh.wikipedia.org/wiki/蒙地卡羅方法)

重点在于：蒙特卡罗方法在数学中的应用，下面摘要了关键的部分。

## 蒙特卡洛积分

非权重蒙特卡罗积分，也称**确定性抽样**，是对被积函数**变量区间**进行**随机均匀抽样**，然后对抽样点的**函数值求平均**，从而可以得到**函数积分的近似值**。

此种方法的正确性是基于**概率论**和**中心极限定理**)。

当抽样点数为m时，使用此种方法所得近似解的统计误差只与m有关（与 $$\frac{1}{\sqrt m}$$正相关），不随积分维数的改变而改变。因此当积分维度较高时，蒙特卡罗方法相对于其他数值解法更优。

## 蒙脱卡洛方法推导

首先，有**一组**独立同分布的随机变量 $$ \{ X_i \} $$ 。注意这是独立同分布的集合包括了多个随机变量。

每一个随机变量 $$ X_i $$ 在 $$ [a,b] $$ 上服从分布 $$  f_x $$ （概率密度函数PDF，积分为1）。  



我们构造一个新的函数 $$ g^*(x) = \frac{g(x)}{f_x{(x)}} $$ ， 然后 $$ g^*(X_i) $$ 也是一个随机变量。

**关键： $$ g^*(X_i ) $$  的概率为 $$ f_x(X_i) $$ !!!**

我们现在计算这个新的随机变量的**期望**：

 $$ E[g^*(X_i)] = \int _a^b g^*(x)f_x(x) dx  = \int _a^b  g(x) d x = I $$ 

根据**强大数定理**：

$$ Pr(\lim_{N \to \infty } \frac {1}{N} \sum_{i=1}^{N} g^*(X_i) = I )= 1 $$

我们项构造一个平均值 $$ \hat I  $$ ，则 $$ \hat I  $$ 依1概率收敛到 $$ I $$ ：

$$ \hat I = \frac {1}{N} \sum_{i=1}^{N} g^*(X_i)  $$



在完成以上的准备条件之后，我们进行实际推导：

**问题：** 我们希望求解积分：

$$  I = \int_a^b g(x) dx $$

**求解：**

1. 假设函数 $$ g(x) $$ 分布在 $$ [a,b] $$ 内可积。

2. 构造任意一个概率密度函数 $$ f_x (x) $$. 满足：

   a.  当 $$  g(x)  \neq 0 $$ 时， $$ f_x(x) \neq 0  $$ , $$ (a < x < b) $$ .

   b.  $$ \int_a^b f_x(x) dx = 1 $$.

引入上面条件,原积分（**期望**）可以写成：

$$ I = \int_a^b g^*(x)f_x(x) dx $$

根据强大数定理得到的平均值（**期望估计**）变为：

$$ \hat I = \frac {1}{N} \sum_{i=1}^{N} g^*(X_i)  $$

根据之前的说明：随着采样次数增多 $$ \hat I  $$ 依概率1收敛到 $$ I $$ ：

**所以 $$ \hat I  $$  可以作为 $$ I $$ 的一个估计。**

如果 $$ f_x $$ 是 $$ [a , b ] $$ 上的一个**均匀分布**的话，那么积分就变成了:

$$ I = (b - a) \int_a^b g(x) \frac{1}{b - a} dx $$

均值就变成了 （ $$ f_x $$ 消失了）：

$$ \hat I = \frac {b - a}{N} \sum_{i=1}^{N} g(X_i)  $$

 $$ \hat I  $$ 就是 $$ I $$ 的估计，蒙特卡洛积分就是：

**用 $$ \frac {b - a}{N} \sum_{i=1}^{N} g(X_i) $$ 估计 $$  \int _a^b  g(x) d x  $$。**



## 蒙特卡洛在渲染当中的应用

这里主要来自一本书：

《Monte Carlo Methods in Global Illumination - Photo-realistic Rendering with Randomization》

主要用来用随机采样的方法解决全局光照渲染的问题。

因为，全局光照的积分是一个难以求和的积分，刚好符合蒙特卡洛积分的思路。

